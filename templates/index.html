{% extends "base.html" %}
{% load socialaccount %}
{% load static %}
{% block styles %}
    <link rel="stylesheet" href="{% static 'css/index.css' %}">
    <script src="{% static 'js/celery_progress.js' %}"></script>
{% endblock %}

{% block spotify %}
<!-- Ambient Organic Blobs -->
<div class="blob blob-1"></div>
<div class="blob blob-2"></div>

<div class="container">
    <!-- Phase 1: URL Input -->
    <div id="phase-input" class="phase-container">
        <div class="wrapper">
            <!-- Brand Header -->
            <header class="brand-header">
                <div class="brand-mark">
                    <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="1.5"/>
                        <path d="M8 15C8.5 12 10.5 10 14 9" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                        <path d="M8 12C8.5 10 10 8.5 13 8" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                        <path d="M8 9C8.3 8 9.5 7 11.5 6.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                    </svg>
                </div>
                <span class="brand-name">Remixify</span>
            </header>

            <!-- Hero Text -->
            <div class="hero-section">
                <h1 class="hero-title">
                    Relive a <span class="highlight">new experience</span><br>in seconds
                </h1>
                <p class="hero-subtitle">Paste your Spotify playlist URL and discover amazing remixes</p>
                <div id="playlist-counter" class="playlist-counter" style="display: none;">
                    <span class="counter-number" id="counter-number">0</span>
                    <span class="counter-label">playlists remixed</span>
                </div>
            </div>
            
            <!-- Search Card -->
            <div class="search-card">
                <form id="playlist-form" class="search-form">
                    {% csrf_token %}
                    <div class="input-wrapper">
                        <svg class="input-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="11" cy="11" r="8"/>
                            <path d="m21 21-4.35-4.35"/>
                        </svg>
                        <input 
                            type="text" 
                            name="url" 
                            id="input_url" 
                            placeholder="https://open.spotify.com/playlist/..."
                            required
                            autocomplete="off"
                        >
                    </div>
                    <button type="submit" id="submit_btn" class="btn-convert">
                        <span class="btn-text">Find Remixes</span>
                        <svg class="btn-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                            <path d="M5 12h14M12 5l7 7-7 7"/>
                        </svg>
                    </button>
                </form>
            </div>
            
            <!-- Progress Section -->
            <div class="progress-section" id="progress-section" style="display: none;">
                <div class="progress-wrapper">
                    <div id="progress-bar" class="progress-bar" style="width: 0%;"></div>
                </div>
                <p id="progress-message" class="progress-message">Searching for remixes...</p>
            </div>
            
            <!-- Feature Pills -->
            <div class="features">
                <div class="feature-pill">
                    <span class="feature-icon">*</span>
                    <span>Smart matching</span>
                </div>
                <div class="feature-pill">
                    <span class="feature-icon">*</span>
                    <span>You choose the tracks</span>
                </div>
                <div class="feature-pill">
                    <span class="feature-icon">*</span>
                    <span>Quality remixes</span>
                </div>
            </div>
            
            <!-- Recent Playlists -->
            <div id="recent-playlists" class="recent-playlists">
                <h3 class="recent-title">Recently Created</h3>
                <div id="recent-list" class="recent-list">
                    <!-- Skeleton loaders shown initially -->
                    <div class="recent-card skeleton">
                        <div class="recent-image shimmer"></div>
                        <div class="recent-info">
                            <div class="skeleton-text shimmer"></div>
                            <div class="skeleton-text short shimmer"></div>
                        </div>
                    </div>
                    <div class="recent-card skeleton">
                        <div class="recent-image shimmer"></div>
                        <div class="recent-info">
                            <div class="skeleton-text shimmer"></div>
                            <div class="skeleton-text short shimmer"></div>
                        </div>
                    </div>
                    <div class="recent-card skeleton">
                        <div class="recent-image shimmer"></div>
                        <div class="recent-info">
                            <div class="skeleton-text shimmer"></div>
                            <div class="skeleton-text short shimmer"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- GitHub Link -->
            <a href="https://github.com/kwakubiney/remixify" target="_blank" rel="noopener noreferrer" class="github-link">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                </svg>
                <span>View Source</span>
            </a>
        </div>
    </div>

    <!-- Phase 2: Track Selection -->
    <div id="phase-selection" class="phase-container" style="display: none;">
        <div class="floating-notes-bg" aria-hidden="true">
            <span class="bg-note bg-note-1">&#9835;</span>
            <span class="bg-note bg-note-2">&#9833;</span>
            <span class="bg-note bg-note-3">&#9834;</span>
            <span class="bg-note bg-note-4">&#9836;</span>
            <span class="bg-note bg-note-5">&#9833;</span>
            <span class="bg-note bg-note-6">&#9835;</span>
        </div>
        <div class="floating-elements" aria-hidden="true">
            <span class="note note-1">&#9835;</span>
            <span class="note note-2">&#9834;</span>
            <span class="note note-3">&#9833;</span>
        </div>
        <div class="selection-wrapper">
            <!-- Header -->
            <header class="selection-header">
                <button id="back-btn" class="btn-back">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M19 12H5M12 19l-7-7 7-7"/>
                    </svg>
                    <span>Back</span>
                </button>
                <div class="playlist-info">
                    <img id="playlist-image" src="" alt="Playlist" class="playlist-thumb">
                    <div>
                        <h2 id="playlist-name" class="playlist-title"></h2>
                        <p id="track-count" class="track-count"></p>
                    </div>
                </div>
            </header>

            <!-- Summary Stats -->
            <div class="summary-stats" id="summary-stats">
                <div class="stat-card stat-high">
                    <span class="stat-label">High match</span>
                    <span class="stat-value" id="stat-high">0</span>
                </div>
                <div class="stat-card stat-medium">
                    <span class="stat-label">Medium</span>
                    <span class="stat-value" id="stat-medium">0</span>
                </div>
                <div class="stat-card stat-none">
                    <span class="stat-label">No match</span>
                    <span class="stat-value" id="stat-none">0</span>
                </div>
            </div>

            <!-- Bulk Actions -->
            <div class="bulk-actions">
                <button id="select-all-high" class="btn-bulk">Select all high matches</button>
                <button id="select-all" class="btn-bulk">Select all</button>
                <button id="deselect-all" class="btn-bulk btn-bulk-secondary">Deselect all</button>
                <span class="selected-count"><span id="selected-count">0</span> tracks selected</span>
            </div>

            <!-- Pagination -->
            <div id="pagination" class="pagination" style="display: none;">
                <!-- Pagination controls will be inserted here -->
            </div>

            <!-- Track List -->
            <div id="track-list" class="track-list">
                <!-- Track cards will be inserted here -->
            </div>

            <!-- Pagination Bottom -->
            <div id="pagination-bottom" class="pagination" style="display: none;">
                <!-- Bottom pagination controls -->
            </div>

            <!-- Create Playlist Button -->
            <div class="create-section">
                <button id="create-btn" class="btn-create" disabled>
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 5v14M5 12h14"/>
                    </svg>
                    <span>Create Playlist</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Phase 3: Success -->
    <div id="phase-success" class="phase-container" style="display: none;">
        <div class="wrapper success-wrapper">
            <div class="success-icon">
                <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                    <polyline points="22,4 12,14.01 9,11.01"/>
                </svg>
            </div>
            <h1 class="success-title">Playlist Created!</h1>
            <p id="success-message" class="success-message"></p>
            <div class="success-actions">
                <a id="spotify-link" href="#" target="_blank" class="btn-spotify">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 0C5.4 0 0 5.4 0 12s5.4 12 12 12 12-5.4 12-12S18.66 0 12 0zm5.521 17.34c-.24.359-.66.48-1.021.24-2.82-1.74-6.36-2.101-10.561-1.141-.418.122-.779-.179-.899-.539-.12-.421.18-.78.54-.9 4.56-1.021 8.52-.6 11.64 1.32.42.18.479.659.301 1.02zm1.44-3.3c-.301.42-.841.6-1.262.3-3.239-1.98-8.159-2.58-11.939-1.38-.479.12-1.02-.12-1.14-.6-.12-.48.12-1.021.6-1.141C9.6 9.9 15 10.561 18.72 12.84c.361.181.54.78.241 1.2zm.12-3.36C15.24 8.4 8.82 8.16 5.16 9.301c-.6.179-1.2-.181-1.38-.721-.18-.601.18-1.2.72-1.381 4.26-1.26 11.28-1.02 15.721 1.621.539.3.719 1.02.419 1.56-.299.421-1.02.599-1.559.3z"/>
                    </svg>
                    <span>Open in Spotify</span>
                </a>
                <button id="new-playlist-btn" class="btn-new">Create Another</button>
            </div>
        </div>
    </div>
</div>

<script src="{% static 'js/index.js' %}"></script>
{% endblock %}